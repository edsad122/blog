

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/fluid.png">
  <link rel="icon" href="/blog/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Edasd">
  <meta name="keywords" content="">
  
    <meta name="description" content="è®¾è®¡åŠŸèƒ½æè¿°ä½¿ç”¨Javaç¼–å†™çš„å°†MiniSysæ±‡ç¼–ç¨‹åºè½¬æ¢åˆ° Minisys ä½“ç³»æœºå™¨ç çš„æ±‡ç¼–å™¨ï¼ŒåŒæ—¶å…¼å…·é“¾æ¥åŠŸèƒ½ã€‚   æ¨¡å—åŠŸèƒ½ main.javaï¼šç¨‹åºå…¥å£ï¼Œå®ç°å‘½ä»¤è¡Œï¼Œ-lè¡¨ç¤ºæ˜¯å¦ä¸biosï¼Œä¸­æ–­ç¨‹åºé“¾æ¥ã€‚ä¾‹ï¼š $ java -jar minisys-java.jar   -l Assembler.javaï¼šå®ç°å¯¹æ•°æ®æ®µã€æŒ‡ä»¤æ®µçš„æ±‡ç¼–ï¼Œå…ˆå¯¹æŒ‡ä»¤è¿›è¡Œå®å±•å¼€ï¼Œå°†æŒ‡ä»¤ä¸labelåˆ†ç¦»å¹¶å‚¨å­˜labe">
<meta property="og:type" content="article">
<meta property="og:title" content="ç”¨Javaå®ç°æ±‡ç¼–å™¨+é“¾æ¥å™¨">
<meta property="og:url" content="https://edsad122.github.io/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/index.html">
<meta property="og:site_name" content="Edasd">
<meta property="og:description" content="è®¾è®¡åŠŸèƒ½æè¿°ä½¿ç”¨Javaç¼–å†™çš„å°†MiniSysæ±‡ç¼–ç¨‹åºè½¬æ¢åˆ° Minisys ä½“ç³»æœºå™¨ç çš„æ±‡ç¼–å™¨ï¼ŒåŒæ—¶å…¼å…·é“¾æ¥åŠŸèƒ½ã€‚   æ¨¡å—åŠŸèƒ½ main.javaï¼šç¨‹åºå…¥å£ï¼Œå®ç°å‘½ä»¤è¡Œï¼Œ-lè¡¨ç¤ºæ˜¯å¦ä¸biosï¼Œä¸­æ–­ç¨‹åºé“¾æ¥ã€‚ä¾‹ï¼š $ java -jar minisys-java.jar   -l Assembler.javaï¼šå®ç°å¯¹æ•°æ®æ®µã€æŒ‡ä»¤æ®µçš„æ±‡ç¼–ï¼Œå…ˆå¯¹æŒ‡ä»¤è¿›è¡Œå®å±•å¼€ï¼Œå°†æŒ‡ä»¤ä¸labelåˆ†ç¦»å¹¶å‚¨å­˜labe">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://edsad122.github.io/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/out.png">
<meta property="og:image" content="https://edsad122.github.io/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/asm.png">
<meta property="og:image" content="https://edsad122.github.io/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/Ins.png">
<meta property="article:published_time" content="2024-01-11T08:17:58.000Z">
<meta property="article:modified_time" content="2024-01-11T15:12:13.789Z">
<meta property="article:author" content="Edasd">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://edsad122.github.io/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/out.png">
  
  
  
  <title>ç”¨Javaå®ç°æ±‡ç¼–å™¨+é“¾æ¥å™¨ - Edasd</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/blog/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/blog/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/blog/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"edsad122.github.io","root":"/blog/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/blog/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/blog/">
      <strong>Edasd</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/blog/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ç”¨Javaå®ç°æ±‡ç¼–å™¨+é“¾æ¥å™¨"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-11 16:17" pubdate>
          2024å¹´1æœˆ11æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.3k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          44 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ç”¨Javaå®ç°æ±‡ç¼–å™¨+é“¾æ¥å™¨</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="è®¾è®¡åŠŸèƒ½æè¿°"><a href="#è®¾è®¡åŠŸèƒ½æè¿°" class="headerlink" title="è®¾è®¡åŠŸèƒ½æè¿°"></a>è®¾è®¡åŠŸèƒ½æè¿°</h1><p>ä½¿ç”¨Javaç¼–å†™çš„å°†MiniSysæ±‡ç¼–ç¨‹åºè½¬æ¢åˆ° Minisys ä½“ç³»æœºå™¨ç çš„æ±‡ç¼–å™¨ï¼ŒåŒæ—¶å…¼å…·é“¾æ¥åŠŸèƒ½ã€‚</p>
<img src="/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/out.png" srcset="/blog/img/loading.gif" lazyload class="" title="å›¾æ–‡æ— å…³ï¼Œç´¯äº†è·‘è·‘å›¾ğŸ¤“">

<h2 id="æ¨¡å—åŠŸèƒ½"><a href="#æ¨¡å—åŠŸèƒ½" class="headerlink" title="æ¨¡å—åŠŸèƒ½"></a>æ¨¡å—åŠŸèƒ½</h2><ul>
<li>main.javaï¼šç¨‹åºå…¥å£ï¼Œå®ç°å‘½ä»¤è¡Œï¼Œ-lè¡¨ç¤ºæ˜¯å¦ä¸biosï¼Œä¸­æ–­ç¨‹åºé“¾æ¥ã€‚ä¾‹ï¼š <em>$ java -jar minisys-java.jar <in_file> <out_dir> -l</em></li>
<li>Assembler.javaï¼šå®ç°å¯¹æ•°æ®æ®µã€æŒ‡ä»¤æ®µçš„æ±‡ç¼–ï¼Œå…ˆå¯¹æŒ‡ä»¤è¿›è¡Œå®å±•å¼€ï¼Œå°†æŒ‡ä»¤ä¸labelåˆ†ç¦»å¹¶å‚¨å­˜labelä»¥åŠå…¶å¯¹åº”çš„åœ°å€ï¼Œéå†æ‰€æœ‰æŒ‡ä»¤è¿›è¡Œæ±‡ç¼–ï¼Œæœ€åè¾“å‡ºAsmProgramï¼ˆåŒ…å«äº†å¤„ç†åçš„æ•°æ®æ®µã€æŒ‡ä»¤æ®µæ•°æ®ï¼‰ã€‚</li>
<li>MiniInstructions.javaï¼šå®ç°57æ¡æŒ‡ä»¤ï¼Œä¿å­˜å…¶ç›¸åº”çš„æ­£åˆ™æ ¼å¼ï¼Œè°ƒç”¨toBinaryæ–¹æ³•å³å¯å®ç°æŒ‡ä»¤è½¬äºŒè¿›åˆ¶ã€‚</li>
<li>Converter.javaï¼šå°†è¾“å…¥çš„AsmProgramè½¬ä¸ºç›¸åº”çš„Coeæ–‡ä»¶ï¼Œä¹Ÿå®ç°äº†å°†æ•°æ®æ®µã€æŒ‡ä»¤æ®µçš„Coeæ–‡ä»¶åˆå¹¶ç”Ÿæˆå¯ä»¥ç›´æ¥åœ¨å¼€æ”¾æ¿ä¸Šè¿è¡Œçš„serialã€‚</li>
<li>Linker.javaï¼šæ ¹æ®MiniSysçš„MEMå¸ƒå±€ï¼ˆBIOS åŒºåŸŸã€ç”¨æˆ·ç¨‹åºåŒºåŸŸã€ä¸­æ–­å¤„ç†ç¨‹åºå…¥å£ã€ä¸­æ–­å¤„ç†ç¨‹åºï¼‰å¯¹äºŒè¿›åˆ¶æ•°æ®å®ç°å†…å­˜çš„å¸ƒå±€ã€åœ°å€çš„é‡å®šä½ã€‚</li>
<li>MacroExpansionRulesï¼šå®ç°å®æŒ‡ä»¤ï¼Œå¯ä»¥å°†pushã€popã€jgã€jgeã€jlã€jleã€moveå®æŒ‡ä»¤è½¬ä¸ºå¸¸ç”¨æŒ‡ä»¤ã€‚</li>
<li>Instruction.javaï¼šå®ç°äº†æŒ‡ä»¤ç±»çš„åº•å±‚é€»è¾‘ï¼Œä¸ºäº†å®ç°å¯¹57æ¡æŒ‡ä»¤çš„å…¼å®¹ï¼ŒåŒ…å«äº†è‡ªå®šä¹‰æ­£åˆ™ã€æŒ‡ä»¤componentListè‡ªå®šä¹‰ã€toBinaryè‡ªå®šä¹‰ï¼ˆæ¯ç§æŒ‡ä»¤çš„æ„æˆã€æ­£åˆ™æ ¼å¼éƒ½æ˜¯ä¸åŒçš„ï¼Œè¿™æ ·å®ç°ç®€å•æ˜“ç”¨ï¼‰ã€‚</li>
<li>Register.javaï¼šå®ç°äº†å¯„å­˜å™¨çš„è½¬æ¢ï¼Œå¯ä»¥å¯¹32ä¸ªé€šç”¨å¯„å­˜å™¨è¿›è¡Œæ˜ å°„ã€‚</li>
<li>Utilsï¼šé€šç”¨å·¥å…·ç±»ï¼Œå®ç°äº†labelè½¬äºŒè¿›åˆ¶ï¼ˆAssemberé‡Œå·²ç»ä¿å­˜äº†labelçš„æ•°æ®ï¼‰ï¼Œå˜é‡è½¬äºŒè¿›åˆ¶ä»¥åŠå„ç§é€šç”¨çš„åå…­è½¬äºŒè¿›åˆ¶ï¼Œåè¿›åˆ¶è½¬äºŒè¿›åˆ¶ï¼Œè®¡ç®—åç§»åœ°å€ï¼Œè·å–æ•°æ®ç±»å‹å¤§å°ç­‰å·¥å…·ã€‚</li>
</ul>
<h1 id="è®¾è®¡çš„ä¸»è¦ç‰¹è‰²"><a href="#è®¾è®¡çš„ä¸»è¦ç‰¹è‰²" class="headerlink" title="è®¾è®¡çš„ä¸»è¦ç‰¹è‰²"></a>è®¾è®¡çš„ä¸»è¦ç‰¹è‰²</h1><h2 id="å®æŒ‡ä»¤æ”¯æŒ"><a href="#å®æŒ‡ä»¤æ”¯æŒ" class="headerlink" title="å®æŒ‡ä»¤æ”¯æŒ"></a>å®æŒ‡ä»¤æ”¯æŒ</h2><p>é€šè¿‡å¯¹å®æŒ‡ä»¤è½¬æ¢ä¸ºMiniSysæ”¯æŒçš„57æ¡å¸¸ç”¨æŒ‡ä»¤ï¼Œå®ç°å¯¹pushã€popã€jgã€jgeã€jlã€jleã€moveå®æŒ‡ä»¤çš„æ”¯æŒã€‚</p>
<h2 id="å†…å­˜çš„å¸ƒå±€ã€åœ°å€çš„é‡å®šä½"><a href="#å†…å­˜çš„å¸ƒå±€ã€åœ°å€çš„é‡å®šä½" class="headerlink" title="å†…å­˜çš„å¸ƒå±€ã€åœ°å€çš„é‡å®šä½"></a>å†…å­˜çš„å¸ƒå±€ã€åœ°å€çš„é‡å®šä½</h2><p>é“¾æ¥å™¨æ ¹æ®MiniSysçš„MEMå¸ƒå±€ï¼ˆBIOS åŒºåŸŸã€ç”¨æˆ·ç¨‹åºåŒºåŸŸã€ä¸­æ–­å¤„ç†ç¨‹åºå…¥å£ã€ä¸­æ–­å¤„ç†ç¨‹åºï¼‰å¯¹äºŒè¿›åˆ¶æ•°æ®å®ç°å†…å­˜çš„å¸ƒå±€ã€åœ°å€çš„é‡å®šä½ï¼Œå¹¶ç”Ÿæˆå¯ä»¥ç›´æ¥åœ¨å¼€æ”¾æ¿ä¸Šä½¿ç”¨çš„serialæ–‡ä»¶ã€‚</p>
<h2 id="æ˜“ç”¨æ€§"><a href="#æ˜“ç”¨æ€§" class="headerlink" title="æ˜“ç”¨æ€§"></a>æ˜“ç”¨æ€§</h2><p>åœ¨Instructionç±»å®ç°ä¸­ï¼Œç”±äºæ­£åˆ™ã€componentListã€toBinaryéƒ½å¯ä»¥è‡ªå®šä¹‰ã€‚å› æ­¤ï¼Œä»…éœ€åœ¨MinisysInstructionsç±»ä¸­åŠ å…¥æ–°æŒ‡ä»¤å¯¹åº”çš„æ­£åˆ™ã€æŒ‡ä»¤æ ¼å¼ã€äºŒè¿›åˆ¶è½¬è¯‘è§„åˆ™ï¼Œå³å¯å®ç°å¯¹æ–°æŒ‡ä»¤çš„æ”¯æŒã€‚</p>
<h1 id="ä½“ç³»ç»“æ„"><a href="#ä½“ç³»ç»“æ„" class="headerlink" title="ä½“ç³»ç»“æ„"></a>ä½“ç³»ç»“æ„</h1><img src="/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/asm.png" srcset="/blog/img/loading.gif" lazyload class="" title="MiniAsmé¡¹ç›®æ¡†æ¶">

<p>æ±‡ç¼–å™¨çš„ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼šAssembleræ¥æ”¶ä¸€ä¸ªåŒ…å«æ±‡ç¼–ä»£ç çš„æ–‡ä»¶ï¼ˆ.asmæ ¼å¼ï¼‰ã€‚é¦–å…ˆï¼Œè¿›è¡Œå®æŒ‡ä»¤æ‰©å±•ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­å¤„ç†æ ‡ç­¾ï¼ˆlabelï¼‰ï¼Œå°†å¤„ç†åçš„ç»“æœå­˜å‚¨åœ¨TextSegLabelä¸­ã€‚éšåï¼Œé€è¡Œå¤„ç†æŒ‡ä»¤ï¼Œå¹¶å°†å¤„ç†åçš„ä¿¡æ¯æ•´åˆåˆ°AsmProgramä¸­ã€‚AsmProgramåŒ…æ‹¬æ•°æ®æ®µï¼ˆDataSegï¼‰å’ŒæŒ‡ä»¤æ®µï¼ˆTextSegï¼‰ã€‚æ•°æ®æ®µä¿å­˜äº†æ‰€æœ‰å˜é‡çš„åç§°ã€ç±»å‹ä»¥åŠç›¸åº”çš„å€¼ï¼Œè€ŒæŒ‡ä»¤æ®µä¿å­˜äº†æ‰€æœ‰æŒ‡ä»¤çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h1 id="è®¾è®¡ä¸ç‰¹è‰²æ¦‚è¿°"><a href="#è®¾è®¡ä¸ç‰¹è‰²æ¦‚è¿°" class="headerlink" title="è®¾è®¡ä¸ç‰¹è‰²æ¦‚è¿°"></a>è®¾è®¡ä¸ç‰¹è‰²æ¦‚è¿°</h1><h2 id="æŒ‡ä»¤ç±»çš„åº•å±‚é€»è¾‘ï¼šInstruction-java"><a href="#æŒ‡ä»¤ç±»çš„åº•å±‚é€»è¾‘ï¼šInstruction-java" class="headerlink" title="æŒ‡ä»¤ç±»çš„åº•å±‚é€»è¾‘ï¼šInstruction.java"></a>æŒ‡ä»¤ç±»çš„åº•å±‚é€»è¾‘ï¼šInstruction.java</h2><img src="/blog/2024/01/11/%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%B1%87%E7%BC%96%E5%99%A8-%E9%93%BE%E6%8E%A5%E5%99%A8/Ins.png" srcset="/blog/img/loading.gif" lazyload class="" title="æŒ‡ä»¤æ ¼å¼">

<p>è¯¥ç±»æ¶µç›–äº†å½“å‰æŒ‡ä»¤çš„å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬æŒ‡ä»¤ç±»å‹ã€æè¿°ã€æŒ‡ä»¤åç§°ã€æŒ‡ä»¤æ­£åˆ™æ¨¡å¼ï¼Œä»¥åŠæ„æˆåˆ—è¡¨ï¼ˆList&lt;InstructionComponent&gt;ï¼‰ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼ŒInstructionComponentç”¨äºå®šä¹‰æŒ‡ä»¤çš„æ„æˆã€‚å…·ä½“è€Œè¨€ï¼ŒMIPSæŒ‡ä»¤åœ¨å›¾ç¤ºä¸­è§„å®šäº†å…¶æ ¼å¼å’Œå«ä¹‰ï¼Œè€ŒInstructionComponentåˆ™æŒ‡æ˜äº†ä»lBitåˆ°rBitä½ç½®çš„äºŒè¿›åˆ¶æ•°æ®çš„ç±»å‹typeã€‚toBinaryæ–¹æ³•å®šä¹‰äº†å¦‚ä½•ç”ŸæˆäºŒè¿›åˆ¶valå€¼ï¼Œè‹¥ä¸éœ€è¦ç”Ÿæˆï¼Œåˆ™ä¸ºnullã€‚æ¯ä¸ªæŒ‡ä»¤åŒ…å«å¤šä¸ªInstructionComponentï¼Œå¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ˜¯å›ºå®šçš„ï¼Œè€Œä¸­é—´çš„ä¸‰ä¸ªé€šè¿‡toBinaryæ–¹æ³•ç”Ÿæˆç›¸åº”çš„äºŒè¿›åˆ¶valå€¼ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è§£æè¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œç„¶åæå–å€¼å¹¶å°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œæœ€åå¡«å…¥ç›¸åº”çš„ä½ç½®ã€‚è¿™ç§è®¾è®¡èƒ½å¤Ÿæœ‰æ•ˆåœ°å®ç°æŒ‡ä»¤çš„è§£æå’ŒäºŒè¿›åˆ¶è¡¨ç¤ºï¼Œä½¿å…¶åœ¨æ±‡ç¼–å™¨ä¸­å‘æŒ¥ä½œç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toBinary</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (InstructionComponent component : components) &#123;<br>        <span class="hljs-keyword">if</span> (component.getVal().trim().isEmpty()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;å°è¯•å°†ä¸å®Œæ•´çš„æŒ‡ä»¤è½¬ä¸º2æˆ–16è¿›åˆ¶ã€‚&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> components.stream().map(InstructionComponent::getVal).reduce(String::concat).orElse(<span class="hljs-string">&quot;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œå®ç°äº†toBinaryæ–¹æ³•ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æå–ä¹‹å‰InstructionComponentä¸­å­˜å‚¨çš„å·²è½¬æ¢ä¸ºäºŒè¿›åˆ¶çš„valå€¼ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªäºŒè¿›åˆ¶æµã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤å¤„çš„toBinaryæ–¹æ³•ä¸å‰æ–‡ä¸­Componentä¸­çš„toBinaryæ–¹æ³•å¹¶ä¸ç›¸åŒã€‚è¿™é‡Œçš„toBinaryæ–¹æ³•ä¸“æ³¨äºå°†Componentä¸­é€šè¿‡toBinaryç”Ÿæˆçš„äºŒè¿›åˆ¶å€¼ï¼ˆå¦‚æœtoBinaryä¸ºnullï¼Œåˆ™ç›´æ¥ä½¿ç”¨valï¼‰æ•´åˆæˆä¸€ä¸ªäºŒè¿›åˆ¶æµã€‚</p>
<h2 id="é€šç”¨æŒ‡ä»¤çš„å®ç°ï¼šMiniInstructions-java"><a href="#é€šç”¨æŒ‡ä»¤çš„å®ç°ï¼šMiniInstructions-java" class="headerlink" title="é€šç”¨æŒ‡ä»¤çš„å®ç°ï¼šMiniInstructions.java"></a>é€šç”¨æŒ‡ä»¤çš„å®ç°ï¼šMiniInstructions.java</h2><p>è¯¥ç±»ä¸ºInstructionçš„ä¸Šå±‚ç±»ï¼Œæ„å»ºäº†57æ¡MIPSé€šç”¨æŒ‡ä»¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">newInstruction(<span class="hljs-string">&quot;add&quot;</span>, <span class="hljs-string">&quot;æŒ‰å­—åŠ æ³•&quot;</span>, <span class="hljs-string">&quot;(rd)â†(rs)+(rt)&quot;</span>, paramPattern(<span class="hljs-number">3</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>[]&#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">31</span>, <span class="hljs-number">26</span>, <span class="hljs-string">&quot;op&quot;</span>, <span class="hljs-literal">null</span>, InstructionComponentType.FIXED, <span class="hljs-string">&quot;000000&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">25</span>, <span class="hljs-number">21</span>, <span class="hljs-string">&quot;rs&quot;</span>, m -&gt; Register.regToBin(m.group(<span class="hljs-number">2</span>)), InstructionComponentType.REG, <span class="hljs-string">&quot;&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">20</span>, <span class="hljs-number">16</span>, <span class="hljs-string">&quot;rt&quot;</span>, m -&gt; Register.regToBin(m.group(<span class="hljs-number">3</span>)), InstructionComponentType.REG, <span class="hljs-string">&quot;&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-string">&quot;rd&quot;</span>, m -&gt; Register.regToBin(m.group(<span class="hljs-number">1</span>)), InstructionComponentType.REG, <span class="hljs-string">&quot;&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-string">&quot;shamt&quot;</span>, <span class="hljs-literal">null</span>, InstructionComponentType.FIXED, <span class="hljs-string">&quot;00000&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;func&quot;</span>, <span class="hljs-literal">null</span>, InstructionComponentType.FIXED, <span class="hljs-string">&quot;100000&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>æ ¹æ®ä¸Šå›¾æ‰€ç¤ºï¼Œé€šè¿‡newInstructionæ–¹æ³•æ„å»ºæ–°æŒ‡ä»¤ã€‚æ­¤æ–¹æ³•æ¥å—æŒ‡ä»¤åç§°ã€æŒ‡ä»¤æè¿°ã€æŒ‡ä»¤æ­£åˆ™å’ŒæŒ‡ä»¤æ„æˆåˆ—è¡¨ç­‰å‚æ•°ï¼Œå…¶ä¸­æŒ‡ä»¤æ„æˆåˆ—è¡¨çš„æ ¼å¼æŒ‰ç…§MIPSæŒ‡ä»¤çš„è§„èŒƒè¾“å…¥ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°æ„å»ºæ–°çš„æŒ‡ä»¤ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒtoBinaryæ–¹æ³•ï¼Œåœ¨å·²ç»è¾“å…¥äº†valæˆ–è€…typeä¸ºFIXEDçš„æƒ…å†µä¸‹ä¼šä¸ºnullã€‚è€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å¤„ç†æŒ‡ä»¤æ­£åˆ™åŒ¹é…åçš„å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">31</span>, <span class="hljs-number">26</span>, <span class="hljs-string">&quot;op&quot;</span>, <span class="hljs-literal">null</span>, InstructionComponentType.FIXED, <span class="hljs-string">&quot;100100&quot;</span>),<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">25</span>, <span class="hljs-number">21</span>, <span class="hljs-string">&quot;rs&quot;</span>, m -&gt; Register.regToBin(m.group(<span class="hljs-number">3</span>)), InstructionComponentType.REG, <span class="hljs-string">&quot;&quot;</span>),<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">20</span>, <span class="hljs-number">16</span>, <span class="hljs-string">&quot;rt&quot;</span>, m -&gt; Register.regToBin(m.group(<span class="hljs-number">1</span>)), InstructionComponentType.REG, <span class="hljs-string">&quot;&quot;</span>),<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">InstructionComponent</span>(<span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;offset&quot;</span>, m -&gt; Utils.varToAddrBin(m.group(<span class="hljs-number">2</span>), <span class="hljs-number">16</span>, <span class="hljs-literal">true</span>), InstructionComponentType.OFFSET, <span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œåœ¨å¤„ç†addæŒ‡ä»¤æ—¶ï¼Œæ­£åˆ™åŒ¹é…åçš„å‚æ•°ä¸ºå¯„å­˜å™¨ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹matcher mçš„groupè¿›è¡ŒregToBinçš„æ“ä½œã€‚å¦‚æœæ˜¯åŒ¹é…åæ˜¯offsetçš„å‚æ•°ï¼Œåˆ™éœ€è¦varToAddrBinæˆ–labelToBinï¼Œimmediateåˆ™ä¸ºliteralToBinã€‚åŒç†ï¼Œå¯ä»¥å¾—åˆ°å…¶ä»–56æ¡æŒ‡ä»¤ã€‚</p>
<h2 id="Register-javaï¼šå¯„å­˜å™¨çš„å®ç°"><a href="#Register-javaï¼šå¯„å­˜å™¨çš„å®ç°" class="headerlink" title="Register.javaï¼šå¯„å­˜å™¨çš„å®ç°"></a>Register.javaï¼šå¯„å­˜å™¨çš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">regToBin</span><span class="hljs-params">(String reg)</span> &#123;<br>        reg = reg.replace(<span class="hljs-string">&quot;$&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).trim();<br>        <span class="hljs-type">int</span> regNumber;<br>        <span class="hljs-keyword">if</span> (reg.matches(<span class="hljs-string">&quot;\\d+&quot;</span>)) &#123;<br>            regNumber = Integer.parseInt(reg);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            regNumber = indexOfRegister(reg);<br>        &#125;<br>        <span class="hljs-keyword">return</span> Utils.decToBin(regNumber, <span class="hljs-number">5</span>,<span class="hljs-literal">false</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>å®ç°å¯„å­˜å™¨åŠŸèƒ½å¹¶ä¸å¤æ‚ã€‚é€šè¿‡æ¥æ”¶è¾“å…¥çš„å¯„å­˜å™¨åç§°ï¼ˆregï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾æ‰¾åˆ°ç›¸åº”çš„å¯„å­˜å™¨ç´¢å¼•ï¼ˆIndexï¼‰ï¼Œç„¶åé€šè¿‡decToBinæ–¹æ³•å°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæœ€ç»ˆè¿›è¡Œè¾“å‡ºã€‚</p>
<h2 id="MacroExpansionRules-javaï¼šå®æŒ‡ä»¤çš„å®ç°"><a href="#MacroExpansionRules-javaï¼šå®æŒ‡ä»¤çš„å®ç°" class="headerlink" title="MacroExpansionRules.javaï¼šå®æŒ‡ä»¤çš„å®ç°"></a>MacroExpansionRules.javaï¼šå®æŒ‡ä»¤çš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">expansionRules.put(<span class="hljs-string">&quot;push&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MacroExpansionRule</span>(<span class="hljs-string">&quot;^push\\s+(\\$\\w&#123;1,2&#125;)$&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;addi $sp, $sp, -4&quot;</span>, <span class="hljs-string">&quot;sw $&#123;RegExp.$1&#125;, 0($sp)&quot;</span>&#125;));<br>expansionRules.put(<span class="hljs-string">&quot;pop&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MacroExpansionRule</span>(<span class="hljs-string">&quot;^pop\\s+(\\$\\w&#123;1,2&#125;)$&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;lw $&#123;RegExp.$1&#125;, 0($sp)&quot;</span>, <span class="hljs-string">&quot;addi $sp, $sp, 4&quot;</span>&#125;));<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">replaceGroups</span><span class="hljs-params">(Matcher matcher, String input)</span> &#123;<br>            <span class="hljs-comment">// Check for presence of $&#123;RegExp.$3&#125;, $&#123;RegExp.$2&#125;, $&#123;RegExp.$1&#125; before replacing</span><br>            <span class="hljs-keyword">if</span> (input.contains(<span class="hljs-string">&quot;$&#123;RegExp.$3&#125;&quot;</span>)) &#123;<br>                input = input.replace(<span class="hljs-string">&quot;$&#123;RegExp.$3&#125;&quot;</span>, getGroup(matcher, <span class="hljs-number">3</span>));<br>            &#125;<br>            <span class="hljs-keyword">if</span> (input.contains(<span class="hljs-string">&quot;$&#123;RegExp.$2&#125;&quot;</span>)) &#123;<br>                input = input.replace(<span class="hljs-string">&quot;$&#123;RegExp.$2&#125;&quot;</span>, getGroup(matcher, <span class="hljs-number">2</span>));<br>            &#125;<br>            <span class="hljs-keyword">if</span> (input.contains(<span class="hljs-string">&quot;$&#123;RegExp.$1&#125;&quot;</span>)) &#123;<br>                input = input.replace(<span class="hljs-string">&quot;$&#123;RegExp.$1&#125;&quot;</span>, getGroup(matcher, <span class="hljs-number">1</span>));<br>            &#125;<br>            <span class="hljs-keyword">return</span> input;<br>        &#125;<br></code></pre></td></tr></table></figure>

<p>å®æŒ‡ä»¤çš„å±•å¼€è¿‡ç¨‹é¦–å…ˆæ¶‰åŠå¯¹ç›¸å…³æŒ‡ä»¤çš„å‚æ•°è·å–ã€‚åœ¨è·å–åˆ°è¿™äº›å‚æ•°ä¹‹åï¼Œé€šè¿‡å¯¹è¿™äº›å‚æ•°çš„åˆæˆæ“ä½œï¼Œç”Ÿæˆæ–°çš„æŒ‡ä»¤åºåˆ—ï¼Œè¿™äº›æŒ‡ä»¤å³ä¸ºé€šç”¨çš„MIPSæŒ‡ä»¤ã€‚æœ€ç»ˆï¼Œå°†è¿™ä¸€æ–°ç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—è¿”å›ï¼Œè¿™ç›¸å½“äºå°†åŸå§‹å®æŒ‡ä»¤åœ¨è¯­ä¹‰ä¸Šæ›¿æ¢ä¸ºç›¸åº”çš„MIPSé€šç”¨æŒ‡ä»¤ã€‚</p>
<h2 id="Assembler-javaï¼šæ±‡ç¼–åŠŸèƒ½çš„ä¸»è¦æ¨¡å—"><a href="#Assembler-javaï¼šæ±‡ç¼–åŠŸèƒ½çš„ä¸»è¦æ¨¡å—" class="headerlink" title="Assembler.javaï¼šæ±‡ç¼–åŠŸèƒ½çš„ä¸»è¦æ¨¡å—"></a>Assembler.javaï¼šæ±‡ç¼–åŠŸèƒ½çš„ä¸»è¦æ¨¡å—</h2><p>è¯¥æ¨¡å—ä¸»è¦æ¶‰åŠä¸¤ä¸ªå…³é”®æ–¹é¢çš„å¤„ç†ï¼Œå³æ•°æ®æ®µå’ŒæŒ‡ä»¤æ®µï¼Œè¿™ä¸¤è€…åœ¨è¯¥æ¨¡å—ä¸­è¿›è¡Œè¯¦ç»†å¤„ç†ã€‚</p>
<h2 id="æ•°æ®æ®µ"><a href="#æ•°æ®æ®µ" class="headerlink" title="æ•°æ®æ®µ"></a>æ•°æ®æ®µ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">startAddr</span> <span class="hljs-operator">=</span> asm.get(<span class="hljs-number">0</span>).split(<span class="hljs-string">&quot;\\s+&quot;</span>).length != <span class="hljs-number">1</span> ? asm.get(<span class="hljs-number">0</span>).split(<span class="hljs-string">&quot;\\s+&quot;</span>)[<span class="hljs-number">1</span>] : <span class="hljs-string">&quot;0&quot;</span>;<br><span class="hljs-keyword">if</span> (asm.get(<span class="hljs-number">0</span>).split(<span class="hljs-string">&quot;\\s+&quot;</span>).length &gt; <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;æ•°æ®æ®µé¦–å£°æ˜éæ³•&quot;</span>);<br>&#125;<br><span class="hljs-comment">//åˆå§‹åŒ–</span><br>List&lt;DataSegVarComp&gt; comps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>vars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-type">int</span> addr;<br><span class="hljs-keyword">if</span>(startAddr.startsWith(<span class="hljs-string">&quot;0x&quot;</span>))&#123;<br>    addr=Integer.parseInt(startAddr.substring(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    addr=Integer.parseInt(startAddr);<br>&#125;<br><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">nextAddr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(addr);<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬è€ƒè™‘æ•°æ®æ®µã€‚æ•°æ®æ®µçš„å¤„ç†åˆ†ä¸ºä¸‰ä¸ªçŠ¶æ€ï¼šåˆå§‹åŒ–ã€æ–°å¢å˜é‡ã€å˜é‡ä¸­ç»§ã€‚åœ¨åˆå§‹åŒ–çŠ¶æ€ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯å¦åŒ…å«.dataï¼Œç„¶åè·å–èµ·å§‹åœ°å€startAddrå’Œä¸‹ä¸€ä¸ªåœ°å€nextAddrã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Matcher</span> <span class="hljs-variable">varStartMatcher</span> <span class="hljs-operator">=</span> VAR_START_PATTERN.matcher(asm.get(i));<br><span class="hljs-type">Matcher</span> <span class="hljs-variable">varContdMatcher</span> <span class="hljs-operator">=</span> VAR_CONTD_PATTERN.matcher(asm.get(i));<br></code></pre></td></tr></table></figure>

<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯æ–°å¢å˜é‡è¿˜æ˜¯å˜é‡ä¸­ç»§çŠ¶æ€ã€‚åœ¨æ–°å¢å˜é‡çŠ¶æ€ä¸­ï¼Œå³å¤„ç†æœ€åˆçš„å˜é‡å£°æ˜ï¼Œå°†ä¸Šä¸€æ¬¡è·å–çš„ä¿¡æ¯å­˜å…¥å˜é‡é›†åˆvarsä¸­ï¼ˆå¦‚æœä¸Šä¸€æ¬¡æ²¡æœ‰ä¿¡æ¯ï¼Œåˆ™è·³è¿‡ï¼‰ã€‚ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªDataSegVarå¯¹è±¡ï¼Œå°†æ­£åˆ™åŒ¹é…å¾—åˆ°çš„å‚æ•°å¡«å…¥nameå’Œtypeå­—æ®µï¼Œè€Œæœ€åä¸€ä¸ªå‚æ•°valueç”±äºasmæ–‡ä»¶ä¸­å¯èƒ½ä½¿ç”¨é€—å·åˆ†éš”å¤šä¸ªå˜é‡ï¼Œéœ€è¦ä½¿ç”¨parseInitValueæ–¹æ³•æ¥å¤„ç†ã€‚parseInitValueæ–¹æ³•èƒ½å¤Ÿè§£æå¹¶å­˜å‚¨æ•°æ®åˆ°DataSegVarä¸­ã€‚ä¸‹å›¾å³ä¸ºparseInitValueçš„è°ƒç”¨ï¼Œè¾“å…¥typeå’ŒMatcherçš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œè·å¾—åˆ°çš„æ•°æ®å°†å…¶å­˜å…¥DataSegVarä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">parseInitValue(type, varStartMatcher.group(<span class="hljs-number">3</span>)).forEach(val -&gt; &#123;<br>    finalComps.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSegVarComp</span>(type, val.trim()));<br>    nextAddr.addAndGet(size * (Objects.equals(type, <span class="hljs-string">&quot;ascii&quot;</span>) ? val.length() : <span class="hljs-number">1</span>));<br>&#125;);<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">parseInitValue</span><span class="hljs-params">(String type, String init)</span> &#123;<br>        <span class="hljs-keyword">assert</span> !(!Objects.equals(type, <span class="hljs-string">&quot;ascii&quot;</span>) &amp;&amp; init.contains(<span class="hljs-string">&quot;\&quot;&quot;</span>)) : <span class="hljs-string">&quot;å­—ç¬¦ä¸²å‹æ•°æ®åªèƒ½ä½¿ç”¨.asciiç±»å‹&quot;</span>;<br>        init = init.trim();<br>        <span class="hljs-keyword">assert</span> init.charAt(<span class="hljs-number">0</span>) != <span class="hljs-string">&#x27;,&#x27;</span> &amp;&amp; init.charAt(init.length() - <span class="hljs-number">1</span>) != <span class="hljs-string">&#x27;,&#x27;</span> : <span class="hljs-string">&quot;æ•°æ®åˆå§‹åŒ–å€¼å¤´æˆ–å°¾æœ‰éæ³•é€—å·&quot;</span>;<br><br>        <span class="hljs-keyword">if</span> (!Objects.equals(type, <span class="hljs-string">&quot;ascii&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> Stream.of(init.split(<span class="hljs-string">&quot;\\s*,&quot;</span>)).toList();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">inQuote</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">nextEscape</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>            List&lt;String&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>            <span class="hljs-type">char</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;\0&#x27;</span>;<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; init.length(); i++) &#123;<br>                <span class="hljs-type">char</span> <span class="hljs-variable">ch</span> <span class="hljs-operator">=</span> init.charAt(i);<br>                <span class="hljs-keyword">if</span> (!inQuote &amp;&amp; Character.isWhitespace(ch)) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;&quot;&#x27;</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (nextEscape) &#123;<br>                        <span class="hljs-keyword">assert</span> inQuote : <span class="hljs-string">&quot;æœ‰éæ³•å­—ç¬¦å‡ºç°åœ¨å¼•å·ä»¥å¤–&quot;</span>;<br>                        buf.append(<span class="hljs-string">&#x27;&quot;&#x27;</span>);<br>                        nextEscape = <span class="hljs-literal">false</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        inQuote = !inQuote;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;\\&#x27;</span>) &#123;<br>                    <span class="hljs-keyword">assert</span> inQuote : <span class="hljs-string">&quot;æœ‰éæ³•å­—ç¬¦å‡ºç°åœ¨å¼•å·ä»¥å¤–&quot;</span>;<br>                    <span class="hljs-keyword">if</span> (nextEscape) &#123;<br>                        buf.append(<span class="hljs-string">&#x27;\\&#x27;</span>);<br>                        nextEscape = <span class="hljs-literal">false</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        nextEscape = <span class="hljs-literal">true</span>;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;,&#x27;</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (inQuote) &#123;<br>                        buf.append(<span class="hljs-string">&#x27;,&#x27;</span>); <span class="hljs-comment">// å¼•å·å†…é€—å·å¯ä¸escape</span><br>                        nextEscape = <span class="hljs-literal">false</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-keyword">assert</span> prev != <span class="hljs-string">&#x27;,&#x27;</span> : <span class="hljs-string">&quot;æ•°æ®åˆå§‹åŒ–å€¼å­˜åœ¨è¿ç»­çš„é€—å·åˆ†éš”&quot;</span>;<br>                        res.add(buf.toString());<br>                        buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">assert</span> inQuote : <span class="hljs-string">&quot;æœ‰éæ³•å­—ç¬¦å‡ºç°åœ¨å¼•å·ä»¥å¤–&quot;</span>;<br>                    <span class="hljs-keyword">if</span> (nextEscape) &#123;<br>                        buf.append(StringProcessor.unraw(ch));<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        buf.append(ch);<br>                    &#125;<br>                    nextEscape = <span class="hljs-literal">false</span>;<br>                &#125;<br>                prev = ch;<br>            &#125;<br>            res.add(buf.toString());<br>            <span class="hljs-keyword">return</span> res;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¸ºparseInitValueçš„å…·ä½“å®ç°ï¼Œæ­¤å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šâ€œtypeâ€å’Œâ€œinitâ€ï¼Œtypeæ˜¯å˜é‡ç±»å‹ï¼Œinitæ˜¯å˜é‡çš„åˆå§‹å€¼ã€‚ â€œparseInitValueâ€å‡½æ•°é¦–å…ˆå£°æ˜ï¼Œå¦‚æœå˜é‡ç±»å‹ä¸æ˜¯â€œasciiâ€ï¼Œåˆ™åˆå§‹å€¼ä¸åº”åŒ…å«åŒå¼•å·å­—ç¬¦ã€‚åˆ¤æ–­åˆå§‹å€¼æ˜¯å¦ä»¥é€—å·å¼€å¤´æˆ–ç»“å°¾ã€‚ å¦‚æœå˜é‡ç±»å‹ä¸æ˜¯â€œasciiâ€ï¼Œåˆ™å‡½æ•°ä¼šç”¨é€—å·åˆ†éš”åˆå§‹å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªä¿®å‰ªåçš„å€¼æ•°ç»„ã€‚ å¦‚æœå˜é‡ç±»å‹ä¸ºâ€œasciiâ€ï¼Œåˆ™å‡½æ•°å°†è¿›å…¥æ›´å¤æ‚çš„è§£æè¿‡ç¨‹ã€‚ å®ƒåˆå§‹åŒ–å‡ ä¸ªå˜é‡ä»¥è·Ÿè¸ªè§£æçŠ¶æ€ï¼ŒåŒ…æ‹¬å®ƒå½“å‰æ˜¯å¦åœ¨å¸¦å¼•å·çš„å­—ç¬¦ä¸²ï¼ˆâ€œinQuoteâ€ï¼‰å†…ï¼Œæ˜¯å¦åº”è½¬ä¹‰ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼ˆâ€œnextEscapeâ€ï¼‰ã€ç»“æœæ•°ç»„ï¼ˆâ€œresâ€ï¼‰ã€å½“å‰å­—ç¬¦ä¸²çš„ç¼“å†²åŒºï¼ˆâ€œbufâ€ï¼‰å’Œå‰ä¸€ä¸ªå­—ç¬¦çš„ç¼“å†²åŒºã€‚ ç„¶åï¼Œå‡½æ•°åœ¨åˆå§‹å€¼ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸Šè¿›å…¥ä¸€ä¸ªå¾ªç¯ã€‚æ ¹æ®å½“å‰å­—ç¬¦å’Œè§£æçŠ¶æ€ï¼Œå®ƒä¼šæ›´æ–°çŠ¶æ€å˜é‡å¹¶å°†å­—ç¬¦æ·»åŠ åˆ°ç¼“å†²åŒºæˆ–ç»“æœæ•°ç»„ä¸­ã€‚ è¯¥å‡½æ•°ä½¿ç”¨â€œassertâ€å‡½æ•°æ¥ç¡®ä¿åˆå§‹å€¼çš„è¯­æ³•æ­£ç¡®ï¼Œå¦‚æœé‡åˆ°éæ³•å­—ç¬¦æˆ–åºåˆ—ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼šå¦‚æœè¾“å…¥çš„æ˜¯<code> a: .ascii &quot;hello&quot;,&quot;world&quot;</code> åˆ™nameä¸ºaï¼Œtypeä¸ºasciiï¼Œç¬¬3ä¸ªå‚æ•°ä¼šäº¤ç»™parseInitValueå¤„ç†æˆåŒ…å«â€helloâ€ã€â€worldâ€çš„Listã€‚</p>
<p>å˜é‡ä¸­ç»§çŠ¶æ€å¤„ç†é™¤äº†ä¸ä¼šæ–°å»ºä¸€ä¸ªDataSegVarä¸å˜é‡å¼€å§‹çŠ¶æ€åŸºæœ¬ä¸€è‡´ã€‚</p>
<h2 id="æŒ‡ä»¤æ®µ"><a href="#æŒ‡ä»¤æ®µ" class="headerlink" title="æŒ‡ä»¤æ®µ"></a>æŒ‡ä»¤æ®µ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">expandMacros</span><span class="hljs-params">(List&lt;String&gt; asm, List&lt;Integer&gt; lineno)</span> &#123;<br>        List&lt;String&gt; expandedAsm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(asm);<br>        String[] macros = MacroExpansionRules.expansionRules.keySet().toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">0</span>]);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">bias</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; asm.size(); i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> asm.get(i);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">labelPreserve</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-type">Pattern</span> <span class="hljs-variable">labelPattern</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;^(\\w+:)\\s*([\\w\\s$]+)$&quot;</span>);<br>            <span class="hljs-type">Matcher</span> <span class="hljs-variable">lableMatcher</span> <span class="hljs-operator">=</span> labelPattern.matcher(v);<br>            <span class="hljs-keyword">if</span> (lableMatcher.matches()) &#123;<br>                labelPreserve = lableMatcher.group(<span class="hljs-number">1</span>);<br>                v = lableMatcher.group(<span class="hljs-number">2</span>).trim();<br>            &#125;<br>            <span class="hljs-keyword">for</span> (String macro : macros) &#123;<br>                <span class="hljs-type">Pattern</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> MacroExpansionRules.expansionRules.get(macro).pattern;<br>                <span class="hljs-type">Matcher</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> pattern.matcher(v);<br>                <span class="hljs-keyword">if</span> (m.matches()) &#123;<br>                    String[] replacer = MacroExpansionRules.expansionRules.get(macro).replace(m);<br>                    replacer[<span class="hljs-number">0</span>] = labelPreserve + <span class="hljs-string">&quot; &quot;</span> + replacer[<span class="hljs-number">0</span>];<br>                    expandedAsm.remove(i + bias);<br>                    expandedAsm.addAll(i + bias, Arrays.asList(replacer));<br><br>                    lineno.remove(i + bias);<br>                    lineno.addAll(i + bias, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(Collections.nCopies(replacer.length, lineno.get(i + bias))));<br>                    bias += replacer.length - <span class="hljs-number">1</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> expandedAsm;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨å¼€å§‹æŒ‡ä»¤æ®µçš„å¤„ç†ä¹‹å‰éœ€è¦å¯¹å…¶è¿›è¡Œå®æŒ‡ä»¤æ‰©å±•ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<code>expandMacros</code>å‡½æ•°ç”¨äºåœ¨æ±‡ç¼–è¯­è¨€æºä»£ç ä¸­æ‰©å±•å®ã€‚è¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<code>asm</code>ï¼ˆæ±‡ç¼–è¯­è¨€æŒ‡ä»¤çš„æ•°ç»„ï¼‰å’Œ<code>lineno</code>ï¼ˆå¯¹åº”äºæŒ‡ä»¤çš„è¡Œå·æ•°ç»„ï¼‰ã€‚</p>
<p>å‡½æ•°å¼€å§‹æ—¶ï¼Œåˆ›å»ºäº†<code>asm</code>æ•°ç»„çš„å‰¯æœ¬ï¼Œå¹¶åˆå§‹åŒ–äº†å‡ ä¸ªå˜é‡ï¼ŒåŒ…æ‹¬<code>macros</code>ï¼ˆä»<code>expansionRules</code>å¯¹è±¡ä¸­è·å–çš„é”®çš„æ•°ç»„ï¼‰ï¼Œä»¥åŠ<code>bias</code>ï¼ˆç”¨äºè·Ÿè¸ªç”±äºæ›¿æ¢æŒ‡ä»¤ä¸ºæ‰©å±•å®è€Œå¼•èµ·çš„åç§»ï¼‰ã€‚</p>
<p>ç„¶åï¼Œå‡½æ•°éå†<code>asm</code>æ•°ç»„ä¸­çš„æ¯ä¸ªæŒ‡ä»¤ã€‚å¯¹äºæ¯ä¸ªæŒ‡ä»¤ï¼Œå®ƒæ£€æŸ¥æ˜¯å¦åŒ¹é…<code>LabelPattern</code>æ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœåŒ¹é…ï¼Œå®ƒä¼šä¿ç•™æ ‡ç­¾éƒ¨åˆ†å¹¶ä¿®å‰ªæŒ‡ä»¤çš„å…¶ä½™éƒ¨åˆ†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå‡½æ•°æ£€æŸ¥æŒ‡ä»¤æ˜¯å¦åŒ¹é…<code>expansionRules</code>å¯¹è±¡ä¸­ä»»ä½•å®çš„æ¨¡å¼ã€‚å¦‚æœåŒ¹é…ï¼Œå®ƒè·å–åŒ¹é…å®çš„æ›¿æ¢å™¨ï¼Œå°†ä¿ç•™çš„æ ‡ç­¾æ·»åŠ åˆ°æ›¿æ¢å™¨ä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å‰ï¼Œç„¶ååœ¨<code>asm</code>æ•°ç»„ä¸­ç”¨æ‰©å±•å®æ›¿æ¢åŸå§‹æŒ‡ä»¤ã€‚å®ƒè¿˜æ›´æ–°<code>lineno</code>æ•°ç»„ä»¥åæ˜ å®æ‰©å±•åçš„æ–°è¡Œå·ï¼Œå¹¶æ›´æ–°<code>bias</code>ä»¥è€ƒè™‘æ•°ç»„é•¿åº¦çš„å˜åŒ–ã€‚</p>
<p>æœ€åï¼Œå‡½æ•°è¿”å›æ‰€æœ‰å®éƒ½å·²æ‰©å±•çš„<code>asm</code>æ•°ç»„ã€‚å‰é¢å®æŒ‡ä»¤å·²ç»ä»‹ç»è¿‡ï¼Œè¿™é‡Œè°ƒç”¨replaceå‡½æ•°ï¼Œå¹¶ä¼ å…¥æ­£åˆ™åŒ¹é…åçš„å‚æ•°å³å¯è¿”å›æ›¿æ¢çš„æŒ‡ä»¤ã€‚å†å°†è¿™äº›å¤„ç†åçš„æŒ‡ä»¤æ’å…¥åˆ°åŸæŒ‡ä»¤ä¸­å¹¶æ›´æ–°linenoã€‚</p>
<p>å¤„ç†å®æŒ‡ä»¤åæ­£å¼åŠ å…¥æŒ‡ä»¤æ®µå¤„ç†ï¼Œå’Œæ•°æ®æ®µçš„å¤„ç†ç›¸åŒï¼Œå…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ ¼å¼é—®é¢˜ï¼Œå†åˆå§‹åŒ–å¼€å§‹åœ°å€startAddrå’Œä¸‹ä¸€ä¸ªåœ°å€nextAddrã€‚ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼Œéœ€è¦å¯¹labelè¿›è¡Œé¢„å¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (labelMatcher.matches()) &#123;<br>    labels.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextSegLabel</span>(labelMatcher.group(<span class="hljs-number">1</span>), insLineno, Utils.getOffsetAddr(startAddr, (insLineno - <span class="hljs-number">1</span>) * Utils.sizeof(<span class="hljs-string">&quot;ins&quot;</span>))));<br>    <span class="hljs-keyword">if</span> (!labelMatcher.group(<span class="hljs-number">2</span>).trim().isEmpty()) &#123;<br>          insLineno++;<br>    &#125;<br>    instructions.add(labelMatcher.group(<span class="hljs-number">2</span>));<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    insLineno++;<br>    instructions.add(v);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>éå†æ‰€æœ‰çš„æŒ‡ä»¤ï¼Œå¯¹äºç¬¦åˆlabelæ­£åˆ™çš„ï¼Œå°†<code>labelçš„åœ°å€ã€labelçš„è¡Œæ•°ã€labelçš„åå­—</code>å­˜å…¥labelså˜é‡ä¸­ã€‚åœ¨è¿›è¡Œè¿™å‡ éƒ¨é¢„å¤„ç†åï¼ŒæŒ‡ä»¤æ®µè¿›å…¥é€è¡Œè½¬è¯‘é˜¶æ®µï¼Œé€è¡Œé˜¶æ®µç”±parseOneLineæ–¹æ³•å¤„ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Instruction <span class="hljs-title function_">parseOneLine</span><span class="hljs-params">(String asm, <span class="hljs-type">int</span> lineno)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†åŠ©è®°ç¬¦</span><br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;^\\s*(\\w+)\\s*(.*)&quot;</span>);<br>        <span class="hljs-type">Matcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> pattern.matcher(asm);<br>        <span class="hljs-keyword">if</span> (!matcher.matches()) &#123;<br>            System.out.print(<span class="hljs-string">&quot;\&quot;æ²¡æœ‰æ‰¾åˆ°æŒ‡ä»¤åŠ©è®°ç¬¦ï¼Œåœ¨ä»£ç ç¬¬ &quot;</span> + lineno);<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">symbol</span> <span class="hljs-operator">=</span> matcher.group(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// æ£€éªŒåŠ©è®°ç¬¦åˆæ³•æ€§</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">instructionIndex</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; minisysInstructions.size(); i++) &#123;<br>            <span class="hljs-keyword">if</span> (minisysInstructions.get(i).getSymbol().equals(symbol)) &#123;<br>                instructionIndex = i;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// å•è¡Œæ±‡ç¼–å»ç©ºæ ¼</span><br>        asm = Utils.serialString(matcher.group(<span class="hljs-number">2</span>));<br>        <span class="hljs-comment">// pcç§»è¿›</span><br>        pc += Utils.sizeof(<span class="hljs-string">&quot;ins&quot;</span>);<br>        <span class="hljs-comment">// å¼€å§‹ç»„è£…Instructionå¯¹è±¡</span><br>        <span class="hljs-type">Instruction</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> Instruction.newInstance(minisysInstructions.get(instructionIndex));<br>        res.setSrc(symbol+<span class="hljs-string">&quot; &quot;</span>+asm);<br>        <span class="hljs-keyword">for</span> (InstructionComponent component : res.getComponents()) &#123;<br>            <span class="hljs-keyword">if</span> (component.getVal().trim().isEmpty()) &#123;<br>                res.setComponent(component.getDesc(), component.toBinary(res.getInsPattern().matcher(asm)));<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå³ä¸ºparseOneLineçš„å…·ä½“å®ç°ï¼Œå‡½æ•°é¦–å…ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»<code>asm</code>å­—ç¬¦ä¸²ä¸­æå–åŠ©è®°ç¬¦ï¼ˆæŒ‡ä»¤çš„ç¬¦å·åç§°ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œå‡½æ•°é€šè¿‡åœ¨<code>MinisysInstructions</code>æ•°ç»„ä¸­æŸ¥æ‰¾å…¶ç´¢å¼•æ¥æ£€æŸ¥åŠ©è®°ç¬¦çš„æœ‰æ•ˆæ€§ã€‚</p>
<p>ç„¶åï¼Œå‡½æ•°ä½¿ç”¨<code>serialString</code>å‡½æ•°ä»<code>asm</code>å­—ç¬¦ä¸²ä¸­åˆ é™¤æ‰€æœ‰ç©ºæ ¼ï¼Œå¹¶å°†ç¨‹åºè®¡æ•°å™¨ï¼ˆ<code>pc</code>ï¼‰å¢åŠ ä¸€ä¸ªæŒ‡ä»¤çš„å¤§å°ã€‚</p>
<p>æ¥ç€ï¼Œå‡½æ•°å¼€å§‹ç»„è£…<code>Instruction</code>å¯¹è±¡ã€‚å®ƒæ ¹æ®åœ¨<code>MinisysInstructions</code>æ•°ç»„ä¸­æ‰¾åˆ°çš„æŒ‡ä»¤åˆ›å»º<code>Instruction</code>ç±»çš„æ–°å®ä¾‹ã€‚å‡½æ•°ç„¶åéå†æŒ‡ä»¤çš„æ¯ä¸ªç»„ä»¶ã€‚å¯¹äºæ¯ä¸ªä¸æ˜¯æŒ‡ä»¤äºŒè¿›åˆ¶ä¸­çš„<code>FIXED</code>çš„ç»„ä»¶ï¼ˆå³éœ€è¦å¡«å……çš„å˜é‡ï¼‰ï¼Œä½¿ç”¨<code>setComponent</code>æ–¹æ³•å°†ç»„ä»¶ä»<code>toBinary</code>ä¸­è·å¾—çš„å€¼è®¾ç½®ä¸ºå…¶äºŒè¿›åˆ¶è¡¨ç¤ºã€‚</p>
<p>æœ€åï¼Œå‡½æ•°è¿”å›ç»„è£…çš„<code>Instruction</code>å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¯¥è¯­å¥ï¼Œä¹Ÿæ˜¯Instructionçš„æ ¸å¿ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">component.toBinary(res.getInsPattern().matcher(asm))<br></code></pre></td></tr></table></figure>

<p>è¯¥è¯­å¥ä¸­çš„toBinaryå³ä¸ºä¸Šé¢InstructionComponentä¸­æåˆ°çš„toBinaryæ–¹æ³•ï¼Œå…¶åŠŸèƒ½æ˜¯ç”ŸæˆäºŒè¿›åˆ¶è¡¨ç¤ºã€‚å…·ä½“å®ç°å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toBinary</span><span class="hljs-params">(Matcher m)</span> &#123;<br>        <span class="hljs-keyword">if</span>(toBinary != <span class="hljs-literal">null</span> &amp;&amp; m.matches())<br>            <span class="hljs-keyword">return</span> toBinary.apply(m);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨Javaä¸­ï¼Œè°ƒç”¨java.util.function.Functionå˜é‡æ—¶éœ€è¦ä½¿ç”¨applyæ–¹æ³•ï¼Œè¿™ä¸€æœºåˆ¶å…è®¸å¯¹å­˜å‚¨çš„å‚æ•°æ‰§è¡Œé¢„å…ˆå®šä¹‰çš„æ“ä½œã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨å¤„ç†addæŒ‡ä»¤ä¸­ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼šå¯¹25ä½åˆ°21ä½çš„äºŒè¿›åˆ¶è¿›è¡Œè½¬æ¢ï¼Œå¯ä»¥é€šè¿‡<code>m -&gt; Register.regToBin(m.group(2))</code>æ¥å®ç°ï¼ˆå…¶ä¸­mè¡¨ç¤ºæ­£åˆ™åŒ¹é…å¯¹è±¡ï¼Œé€šè¿‡m.group(2)è·å–ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¹¶å¯¹å…¶æ‰§è¡Œå¯„å­˜å™¨è½¬äºŒè¿›åˆ¶çš„æ“ä½œï¼‰ã€‚</p>
<p>è¿™ç§æœºåˆ¶çš„ä¼˜åŠ¿åœ¨äºï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥çµæ´»åœ°è·å–æŒ‡ä»¤çš„å„ä¸ªå‚æ•°ã€‚é€šè¿‡è°ƒç”¨applyæ–¹æ³•ï¼Œå°†æ­£åˆ™åŒ¹é…åçš„å‚æ•°ä¼ é€’ç»™å‡½æ•°å˜é‡ï¼Œå¯ä»¥è½»æ¾å®ç°äºŒè¿›åˆ¶çš„è½¬æ¢ã€‚è¿™ä½¿å¾—æŒ‡ä»¤çš„å¤„ç†è¿‡ç¨‹æ›´åŠ çµæ´»ã€æ¨¡å—åŒ–ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒæŒ‡ä»¤æ ¼å¼çš„éœ€æ±‚ã€‚</p>
<h2 id="Linker-java-é“¾æ¥å™¨çš„å®ç°"><a href="#Linker-java-é“¾æ¥å™¨çš„å®ç°" class="headerlink" title="Linker.java é“¾æ¥å™¨çš„å®ç°"></a>Linker.java é“¾æ¥å™¨çš„å®ç°</h2><p>Minisys ä½“ç³»ä½¿ç”¨å“ˆä½›ç»“æ„ï¼ŒæŒ‡ä»¤ MEM æœ‰ 64 KBï¼ŒæŒ‰å­—èŠ‚ç¼–å€ã€‚å› æ­¤ï¼Œå…¶åœ°å€èŒƒå›´ä¸º 0x00000000 ~ 0x0000FFFFã€‚æŒ‡ä»¤ MEM å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>0x00000000 ~ 0x00000499</td>
<td>BIOS åŒºåŸŸã€‚å¤§å°ä¸º 500 H &#x3D; 1280 D Byteï¼Œæœ€å¤šå­˜æ”¾ 1280 &#x2F; 4 &#x3D; 320 æ¡æŒ‡ä»¤ã€‚</td>
</tr>
<tr>
<td>0x00000500 ~ 0x00005499</td>
<td>ç”¨æˆ·ç¨‹åºåŒºåŸŸã€‚å¤§å°ä¸º 5000 H &#x3D; 20480 D Byteï¼Œæœ€å¤šå­˜æ”¾ 20480 &#x2F; 4 &#x3D;  5120 æ¡æŒ‡ä»¤ã€‚</td>
</tr>
<tr>
<td>0x00005500 ~ 0x0000EFFF</td>
<td>ç©ºã€‚</td>
</tr>
<tr>
<td>0x0000F000 ~ 0x0000F499</td>
<td>ä¸­æ–­å¤„ç†ç¨‹åºå…¥å£ã€‚å¤§å°ä¸º 500 H &#x3D; 1280 D Byteï¼Œæœ€å¤šå­˜æ”¾ 1280 &#x2F; 4 &#x3D; 320 æ¡æŒ‡ä»¤ã€‚</td>
</tr>
<tr>
<td>0x0000F500 ~ 0x0000FFFF</td>
<td>ä¸­æ–­å¤„ç†ç¨‹åºã€‚å¤§å°ä¸º B00 H &#x3D; 2816 D Byteï¼Œæœ€å¤šå­˜æ”¾ 2816 &#x2F; 4 &#x3D; 704 æ¡æŒ‡ä»¤<br />ã€‚</td>
</tr>
</tbody></table>
<p>é€šè¿‡å‰è¿°è®¡ç®—ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—çŸ¥æŒ‡ä»¤çš„æœ€é«˜é™åˆ¶å’Œä½ç½®åˆ†å¸ƒã€‚åœ¨é“¾æ¥å™¨ä¸­ï¼Œé€šè¿‡countInsæ–¹æ³•è®¡ç®—asmæ–‡ä»¶ä¸­çš„æŒ‡ä»¤ä¸ªæ•°ã€‚å¦‚æœè®¡ç®—å¾—åˆ°çš„æŒ‡ä»¤ä¸ªæ•°è¶…è¿‡äº†æœ€é«˜é™åˆ¶ï¼Œå°†è§¦å‘é”™è¯¯å¤„ç†ã€‚åä¹‹ï¼Œè‹¥æœªè¶…è¿‡é™åˆ¶ï¼Œåˆ™é€šè¿‡æ·»åŠ nopï¼ˆç©ºæŒ‡ä»¤ï¼‰è¿›è¡Œè¡¥å……ï¼Œä»¥ä½¿æŒ‡ä»¤æ•°é‡è¾¾åˆ°ç›¸åº”çš„åœ°å€è¦æ±‚ã€‚å®ç°å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// User App 0x00000500 ~ 0x00005499</span><br><span class="hljs-type">int</span> <span class="hljs-variable">userASMInsCount</span> <span class="hljs-operator">=</span> countIns(userASM);<br>assertLength(userASMInsCount, <span class="hljs-number">5120</span>, <span class="hljs-string">&quot;ç”¨æˆ·ç¨‹åºæ®µè¿‡é•¿ã€‚&quot;</span>);<br><span class="hljs-type">int</span> <span class="hljs-variable">userNopPadding</span> <span class="hljs-operator">=</span> <span class="hljs-number">5120</span> - userASMInsCount;<br><br>....å…¶ä»–åŒºåŸŸä»£ç <br><br><span class="hljs-comment">// User Application</span><br>allProgram.append(<span class="hljs-string">&quot;# ====== User Application START ======\n&quot;</span>);<br>allProgram.append(<span class="hljs-string">&quot;# User Application Length = &quot;</span>).append(userASMInsCount).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>allProgram.append(userASM).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>allProgram.append(<span class="hljs-string">&quot;# User Application Padding = &quot;</span>).append(userNopPadding).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>allProgram.append(<span class="hljs-string">&quot;nop\n&quot;</span>.repeat(userNopPadding));<br>allProgram.append(<span class="hljs-string">&quot;# ====== User Application END ======\n&quot;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="Converter-javaï¼šCoeæ–‡ä»¶çš„ç”Ÿæˆ"><a href="#Converter-javaï¼šCoeæ–‡ä»¶çš„ç”Ÿæˆ" class="headerlink" title="Converter.javaï¼šCoeæ–‡ä»¶çš„ç”Ÿæˆ"></a>Converter.javaï¼šCoeæ–‡ä»¶çš„ç”Ÿæˆ</h2><p>å¯¹äºæŒ‡ä»¤æ®µï¼Œç”±textsegToCoeæ–¹æ³•ç”Ÿæˆã€‚è¯¥æ–¹æ³•ä¸­ä¸»è¦å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Instruction ins : textSeg.getIns()) &#123;<br>           <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>           <span class="hljs-keyword">for</span> (InstructionComponent comp : ins.getComponents()) &#123;<br>               buf.append(comp.getVal());<br>           &#125;<br>           coe.append(Utils.binToHex(buf.toString(), <span class="hljs-literal">false</span>)).append(<span class="hljs-string">&quot;,\n&quot;</span>);<br>           lineno++;<br>       &#125;<br></code></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•çš„ä¸»è¦æ“ä½œå°±æ˜¯å°†ä¹‹å‰InstrumentComponentä¸­toBinaryæ–¹æ³•å¾—åˆ°çš„valè¿›è¡Œåˆå¹¶ç”ŸæˆäºŒè¿›åˆ¶è¡¨ç¤ºã€‚</p>
<h1 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h1><ol>
<li><p>è¯·åœ¨jaræ–‡ä»¶è·¯å¾„ä¸‹ï¼Œåˆ›å»ºbiosçš„æ–‡ä»¶ï¼Œå°†src\snippetä¸­3ä¸ªasmæ–‡ä»¶æ”¾è¿›biosä¸­</p>
<ul>
<li>å¦‚æœæ²¡æœ‰asmæ–‡ä»¶ï¼Œæ— æ³•ä½¿ç”¨é“¾æ¥ï¼Œæ—¢æ— æ³•åŠ ä¸Š â€œ-lâ€ å‚æ•°ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨è‡ªå·±çš„biosæ–‡ä»¶ï¼Œä½†éœ€è¦æ”¹æˆç›¸åº”çš„åå­—ã€‚</li>
<li>src\snippetä¸­3ä¸ªæ–‡ä»¶åˆ†åˆ«ç”¨æ¥ï¼šbioså¼•å¯¼ç³»ç»Ÿç¨‹åºå…¥å£ã€interpret-entryä¸­æ–­ç¨‹åºçš„å…¥å£ã€interpret-handlerä¸­æ–­ç¨‹åºå¤„ç† ã€‚</li>
</ul>
</li>
<li><p>jarçš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs delphi">jaræ–‡ä»¶è·¯å¾„<br>â”‚  miniasm-java.jar<br>â”‚<br>â””â”€bios<br>        minisys-bios.<span class="hljs-keyword">asm</span><br>        minisys-<span class="hljs-keyword">interrupt</span>-entry.<span class="hljs-keyword">asm</span><br>        minisys-<span class="hljs-keyword">interrupt</span>-handler.<span class="hljs-keyword">asm</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>æŒ‡ä»¤æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­ â€œ-lâ€ ä¸ºå¯é€‰é€‰é¡¹ï¼Œè¡¨ç¤ºæ˜¯å¦é“¾æ¥ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ java -jar minisys-java.jar &lt;in_file&gt; &lt;out_dir&gt; -l<br></code></pre></td></tr></table></figure>

<p>&lt;in_file&gt; è¡¨ç¤ºè¾“å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œ&lt;out_dir&gt;è¡¨ç¤ºè¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼Œè¾“å‡ºçš„æ–‡ä»¶å¦‚æœæ²¡åˆ›å»ºåˆ™ä¼šæ–°å»ºã€‚å¦‚æœè¾“å…¥çš„æ–‡ä»¶å’Œjaråœ¨åŒä¸€è·¯å¾„ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨<code>$ java -jar minisys-java.jar in.asm out -l</code></p>
<p><code>in.asm</code>å¯æ›¿æ¢è‡ªå·±çš„asmæ–‡ä»¶åå­—ï¼Œè¾“å‡ºçš„æ–‡ä»¶ä¼šä¿æŒåœ¨å½“å‰ç›®å½•çš„outæ–‡ä»¶å¤¹é‡Œé¢ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚</p>
<h1 id="æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç”¨ä¾‹</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-meta">.DATA</span> <span class="hljs-number">0x00001000</span><br><span class="hljs-keyword">buf: </span><span class="hljs-meta">.WORD</span> <span class="hljs-number">0x000000ff</span>,<span class="hljs-number">0x55005500</span><br><span class="hljs-keyword">buf2: </span>.<span class="hljs-keyword">byte </span><span class="hljs-number">1</span><br>      <span class="hljs-meta">.ascii</span> <span class="hljs-string">&quot;hello&quot;</span><br><span class="hljs-meta">.TEXT</span> <span class="hljs-number">0x00003456</span><br><span class="hljs-symbol">start:</span>  <span class="hljs-keyword">addi </span> $<span class="hljs-built_in">t0</span>, $<span class="hljs-built_in">zero</span>, <span class="hljs-number">0</span><br>        <span class="hljs-keyword">lw </span>   $<span class="hljs-built_in">v0</span>, <span class="hljs-number">20</span>($<span class="hljs-built_in">t0</span>)<br>        <span class="hljs-keyword">addi </span> $<span class="hljs-built_in">t0</span>, $<span class="hljs-built_in">t0</span>, <span class="hljs-number">4</span><br>        <span class="hljs-keyword">lw </span>   $<span class="hljs-built_in">v1</span>, <span class="hljs-number">20</span>($<span class="hljs-built_in">t0</span>)<br>        <span class="hljs-keyword">add </span>  $<span class="hljs-built_in">v0</span>, $<span class="hljs-built_in">v0</span>, $<span class="hljs-built_in">v1</span><br>        <span class="hljs-keyword">addi </span> $<span class="hljs-built_in">t0</span>, $<span class="hljs-built_in">t0</span>, <span class="hljs-number">4</span><br>        <span class="hljs-keyword">sw </span>   $<span class="hljs-built_in">v0</span>, <span class="hljs-number">20</span>($<span class="hljs-built_in">t0</span>)<br>        <span class="hljs-keyword">j </span>    start<br>```<br></code></pre></td></tr></table></figure>

<p>è¾“å…¥æ•°æ®å¦‚ä¸Šï¼Œè¾“å‡ºçš„è§£æç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-symbol">textSeg:</span>&#123;<br><span class="hljs-symbol">	startAddr:</span><span class="hljs-number">13400</span>,	<span class="hljs-keyword">Instruction:&#123;</span><br><span class="hljs-keyword"></span>		<span class="hljs-keyword">addi </span>$<span class="hljs-built_in">t0</span>,$<span class="hljs-built_in">zero</span>,<span class="hljs-number">0</span>	 Hex:<span class="hljs-number">20080000</span><br>		<span class="hljs-keyword">lw </span>$<span class="hljs-built_in">v0</span>,<span class="hljs-number">20</span>($<span class="hljs-built_in">t0</span>)	 Hex:<span class="hljs-number">8</span>d020014<br>		<span class="hljs-keyword">addi </span>$<span class="hljs-built_in">t0</span>,$<span class="hljs-built_in">t0</span>,<span class="hljs-number">4</span>	 Hex:<span class="hljs-number">21080004</span><br>		<span class="hljs-keyword">lw </span>$<span class="hljs-built_in">v1</span>,<span class="hljs-number">20</span>($<span class="hljs-built_in">t0</span>)	 Hex:<span class="hljs-number">8</span>d030014<br>		<span class="hljs-keyword">add </span>$<span class="hljs-built_in">v0</span>,$<span class="hljs-built_in">v0</span>,$<span class="hljs-built_in">v1</span>	 Hex:<span class="hljs-number">00431020</span><br>		<span class="hljs-keyword">addi </span>$<span class="hljs-built_in">t0</span>,$<span class="hljs-built_in">t0</span>,<span class="hljs-number">4</span>	 Hex:<span class="hljs-number">21080004</span><br>		<span class="hljs-keyword">sw </span>$<span class="hljs-built_in">v0</span>,<span class="hljs-number">20</span>($<span class="hljs-built_in">t0</span>)	 Hex:ad020014<br>		<span class="hljs-keyword">j </span>start	 Hex:<span class="hljs-number">08000</span>d16<br>	&#125;,<br><span class="hljs-symbol">	Labels:</span>&#123;<br>		start<br>	&#125;<br>&#125;<br><span class="hljs-symbol">dataSeg:</span>&#123;<br><span class="hljs-symbol">	startAddr:</span><span class="hljs-number">0x00001000</span>	,vars:&#123;<br><span class="hljs-symbol">	name:</span><span class="hljs-keyword">buf	</span><span class="hljs-keyword">addr:4096	</span>&#123;<br><span class="hljs-symbol">		type:</span>word	val:<span class="hljs-number">0x000000ff</span><br><span class="hljs-symbol">		type:</span>word	val:<span class="hljs-number">0x55005500</span><br>	&#125;<br><span class="hljs-symbol">	name:</span><span class="hljs-keyword">buf2	</span><span class="hljs-keyword">addr:4104	</span>&#123;<br><span class="hljs-symbol">		type:</span><span class="hljs-keyword">byte	</span>val:<span class="hljs-number">1</span><br><span class="hljs-symbol">		type:</span>ascii	val:hello<br>	&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°dataSegé‡Œé¢å­˜å‚¨äº†startAddræ•°æ®ä»¥åŠvarsï¼Œvarsä¸­å­˜å‚¨äº†å…·ä½“çš„å˜é‡typeä»¥åŠvalã€‚</p>
<p>å¯¹äºtextSegé‡Œé¢ä¹Ÿå­˜å‚¨äº†startAddrï¼Œå¯¹äºInstructionä¹ŸæˆåŠŸè½¬è¯‘ä¸ºäºŒè¿›åˆ¶ã€‚</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ç”¨Javaå®ç°æ±‡ç¼–å™¨+é“¾æ¥å™¨</div>
      <div>https://edsad122.github.io/blog/2024/01/11/ç”¨Javaå®ç°æ±‡ç¼–å™¨-é“¾æ¥å™¨/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Edasd</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2024å¹´1æœˆ11æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2025/11/13/VLA/" title="VLAè®ºæ–‡é˜…è¯»">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">VLAè®ºæ–‡é˜…è¯»</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2024/01/08/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/" title="æµ‹è¯•æ–‡ç« ">
                        <span class="hidden-mobile">æµ‹è¯•æ–‡ç« </span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/blog/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/blog/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/blog/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
